<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Cascade Studio Gallery</title>
        <!--<heading style="display:none;">Cascade Studio</heading>-->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="application-name" content="Cascade Studio">
        <meta name="description" content="A Full Live-Scripted CAD Kernel in the Browser">
        <meta name="keywords" content="SCAD, OpenSCAD, CAD, OpenCascade, Scripting">
        <meta name="author" content="Johnathon Selstad">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="theme-color" content="#1e1e1e">

        <!-- Include Tailwind.css -->
        <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>
        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-storage.js"></script>
        <!-- Include the Firebase Sign-in Auth UI -->
        <script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script>
        <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.css" />

        <!-- Inject Headers/Footers, Handle Basic Auth, etc. -->
        <script type="text/javascript" src = "/Gallery/js/main.js"></script>
        
    </head>

    <body style="margin: 0; background: rgb(54, 54, 54); color: white; ">
      <h1 class="m-8 mb-3 text-3xl">Upload Project</h1>
      <div class="shadow-md rounded px-8 pt-6 pb-8 mb-4 flex flex-col my-2">
        <div class="-mx-3 md:flex mb-6">
          <div class="md:w-1/4 px-3 mb-6 md:mb-0">
            <label for="grid-projectname" class="block uppercase tracking-wide text-grey-darker text-xs font-bold mb-2">
              Project Name
            </label>
            <input id="grid-projectname" type="text" placeholder="Enter your Project's Name Here" class="appearance-none block w-full text-gray-800 border border-red rounded py-3 px-4 mb-3">
          </div>
          <div class="md:w-1/4 px-3 mb-6 md:mb-0">
            <label for="grid-thumbnail" class="block uppercase tracking-wide text-grey-darker text-xs font-bold mb-2">
              Preview Image URL
            </label>
            <input id="grid-thumbnail" type="text" placeholder="???" class="appearance-none block w-full text-gray-800 border border-red rounded py-3 px-4 mb-3">
          </div>
        </div>
        <div class="-mx-3 md:flex mb-6">
          <div class="md:w-1/3 px-3">
            <label class="block uppercase tracking-wide text-grey-darker text-xs font-bold mb-2" for="grid-description">
              Description
            </label>
            <textarea id="grid-description" placeholder="Use this description to tell visitors about about the project." class="appearance-none block w-full h-16 text-gray-800 border border-grey-lighter rounded py-3 px-4 mb-3"> </textarea>
          </div>
        </div>
        <div class="-mx-3 md:flex mb-2">
          <button id="save-button" class="inline-block text-sm px-4 py-2 leading-none border rounded text-white border-white hover:border-transparent hover:text-teal-500 hover:bg-white mt-0 ml-4">Save</button>
        </div>
      </div>

      <!-- Pre-populate the above fields with defaults -->
      <script>
        onLoadUserProfile.push((userProfileData, user)=>{
          // Get the Relevant Fields
          let nameElem             = document.getElementById("grid-projectname");
          let descriptionElem      = document.getElementById("grid-description");
          let previewElem          = document.getElementById("grid-thumbnail");

          //// Populate those fields with the relevant information
          //nameElem    .placeholder = userProfileData.username;
          //nameElem          .value = userProfileData.username;
          //descriptionElem   .value = userProfileData.summary;
          //previewElem       .value = userProfileData.avatar;

          // Save the modifications to those fields with the values from the database
          document.getElementById("save-button").onclick = (event) => {
            console.log(user.uid);
            // Upload the preview image to the storage bucket?

            // Create the Project Entry in the database
            db.collection("projects").add({
              name        : nameElem       .value,
              preview     : previewElem    .value,
              description : descriptionElem.value,
              author      : userProfileData.username,
              author_uid  : user           .uid,
              created     : firebase.firestore.FieldValue.serverTimestamp(),
              modified    : firebase.firestore.FieldValue.serverTimestamp(),
              favorites   : [],
              visibility  : "public",
            }).then(function(docRef) {
                console.log("Document written with ID: ", docRef.id);
                db.collection("users/"+user.uid).update({
                  projects: firebase.firestore.FieldValue.arrayUnion(docRef.id)
                });
            })
            .catch(function(error) {
                console.error("Error adding document: ", error);
            });
          };
        });
      </script>

    </body>
</html>
